<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>  
    pre {
            font-family: "Courier 10 Pitch", Courier, monospace;
            font-size: 95%;
            line-height: 140%;
            white-space: pre;
            white-space: pre-wrap;
            white-space: -moz-pre-wrap;
            white-space: -o-pre-wrap;
        }          
    code {
        font-family: Monaco, Consolas, "Andale Mono", "DejaVu Sans Mono", monospace;
        font-size: 95%;
        line-height: 140%;
        white-space: pre;
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -o-pre-wrap;
        background: #faf8f0;
    }
    .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 50%;
    }
    div.padded {  
      padding-top: 0px;  
      padding-right: 100px;  
      padding-bottom: 0.25in;  
      padding-left: 100px;  
    }  
  </style> 
<title>Gang Yao  |  CS 184</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
</head>
<body>
<br />
<h1 align="middle">Assignment 3: PathTracer</h1>
    <h2 align="middle">Gang Yao</h2>

    <div class="padded">
    <p>In this project, I extend pathtracer 3-1 to being able to render mirror reflective and glass refractive material objects. Then I chose to implement microfacet material model to describe all kinds of materials. </p>

    <h2 align="middle">Part 1: Mirror and Glass Materials</h2>
        <p>In this part, I implemented the BRDF sampling function to model mirror and glass materials.</p>
        <p>For reflection, since the input and output ray is described in local hit point object space, we just need to invert the x and y component of the input vector to get the reflected ray. Then, sampling from a mirror material is just to generate this reflected ray and set the *pdf to 1. Also, pure reflection doesn't lose any energy, so we return <code>reflectance / abs_cos(*wi)</code></p>
        <p>For refraction, we need to first determine if the incomming ray is shooting into or out of the given object. This can be checked by the dot product between the surface normal and input ray. Then, we apply Snail's law to calculate the output(*wi) ray direction. Then we use Schlick's approximation to estimate the amount of light reflected and refracted at the hit point. According to Schlick's model, the specular reflection coefficient R can be approximated by:</p>
        <div class="center"><img src="images/schlick.png" width="240px" /></div>
        <p>where θ is the angle between the direction from which the incident light is coming and the normal of the interface between the two media. And n1, n2 are the indices of refraction of the two media at the interface and R0 is the reflection coefficient for light incoming parallel to the normal (i.e., the value of the Fresnel term when θ=0 or minimal reflection). In computer graphics, one of the interfaces is usually air, meaning that n1 can be approximated as 1.</p>
        <h4>Results - Sample Rate 64, Rays per light 4</h4>
        <div align="center">
            <table style="width=100%">
                <tr>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_0.png" width="360px" />
                        <figcaption align="middle">m = 0</figcaption>
                    </td>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_1.png" width="360" />
                        <figcaption align="middle">m = 1</figcaption>
                    </td>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_2.png" width="360" />
                        <figcaption align="middle">m = 2</figcaption>
                    </td>
                </tr>
                <tr>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_3.png" width="360px" />
                        <figcaption align="middle">m = 3</figcaption>
                    </td>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_4.png" width="360" />
                        <figcaption align="middle">m = 4</figcaption>
                    </td>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_5.png" width="360" />
                        <figcaption align="middle">m = 5</figcaption>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td align="middle">
                        <img src="images/CBsphere_64_4_100.png" width="360" />
                        <figcaption align="middle">m = 100</figcaption>
                    </td>
                </tr>
            </table>
        </div>
        <p>When ray depth m equals 0, there is only light from the top light. When m = 1, only one bounce light direct illumination is rendered, the mirror ball perfectly reflects the top light and we can only see the reflected component of the glass ball. When m = 2, we can see the reflected objects on the mirror ball, but only with one bounce illumination. So now, the glass ball reflected on the mirror ball is still black, just like m = 1. When we further increase m, more details from multi bounced lights are rendered, and the glass ball inside the mirror ball looks exactly the same as the previous ray depth m-1. </p>
        <!-- <p>Here is an example of how to include a simple formula:</p>
        <p align="middle"><pre align="middle">a^2 + b^2 = c^2</pre></p>
        <p>or, alternatively, you can include an SVG image of a LaTex formula.</p>
        <p>This time it's your job to copy-paste in the rest of the sections :)</p> -->
    <h2 align="middle">Part 2: Microfacet Material</h2>
    <p>In this part, I implemented the Microfacet model, isotropic rough conductors that only reflect. This material is composed of many small reflective surfaces. The surface normal of the material comply to the Normal distribution function. Here we use the Beckmann distribution. This function also queries α, which describes the roughness of the material.The higher α is, the more diffuse the material looks, and conversely, the lower the α, the more specular looking the material is.</p>
    <!-- <div align="middle">
        <td class="center">
            <img src="images/beck.png" width="180" />
        </td>
    </div> -->
    <p>Then we calculate the Fresnel term according to this material's η and k to describe the radiance transfer character of this material. We calculate it at R, G and B wavelength to best simulate the physical derivation.</p>
    <p>Finally, we implement importance sampling for BRDF, to replace the cosine hemisphere sampling in the skeleton code. We want to sample according to the ray weight on its pdf derived from Beckmann NDF. For some value pdf, we sample the θ and φ describing the half vector to reflect the input ray with. The we calculate the corresponding BRDF value with the sampled vector.</p>
    <h4>Results - Roughness - Sample Rate 256, Rays per Light 1, Max Ray Depth 7</h4>
    <p>As we can see for this dragon model, it appears to be very reflective when α is small. As α increases, the models becomes more diffuse looking. Also observe that when α is small, the image has a lot of white dotted noise. This is because when α is small, the Beckmann NDF is more concentrated, this could potentially magnify the effect of sampling noise.</p>
    <div align="center">
        <table style="width=100%">
            <tr>
                <td align="middle">
                    <img src="images/CBDragon_256_1_7_0.005.png" width="360px" />
                    <figcaption align="middle">α = 0.005</figcaption>
                </td>
                <td align="middle">
                    <img src="images/CBDragon_256_1_7_0.05.png" width="360" />
                    <figcaption align="middle">α = 0.05</figcaption>
                </td>
            </tr>
            <tr>
                <td align="middle">
                    <img src="images/CBDragon_256_1_7_0.25.png" width="360px" />
                    <figcaption align="middle">α = 0.25</figcaption>
                </td>
                <td align="middle">
                    <img src="images/CBDragon_256_1_7_0.5.png" width="360" />
                    <figcaption align="middle">α = 0.5</figcaption>
                </td>
            </tr>
        </table>
    </div>
    <h4>Results - Sampling Method - Sample Rate 64, Rays per Light 1, Max Ray Depth 7</h4>
    <p>Observe that for hemisphere sampling, the bunny is much more noiser, and the edges appear to be dark. This is because at those edge points, the depth component of the surface normal tends to be close to zero, which means most of the cosine hemisphere sampled rays do not hit the light, resulting in dark edges. Compared to that, importance sampling greatly reduce the noise level and has generally better visual quality.</p>
    <div align="center">
        <table style="width=100%">
            <tr>
                <td align="middle">
                    <img src="images/CBBunny_64_1_7_hemi.png" width="360px" />
                    <figcaption align="middle">Cosine Hemisphere Sampling</figcaption>
                </td>
                <td align="middle">
                    <img src="images/CBBunny_64_1_7.png" width="360" />
                    <figcaption align="middle">Importance Sampling</figcaption>
                </td>
            </tr>
        </table>
    </div>
    <h4>Result - Different Material - Sample Rate 1024, Rays per Light 4, Max Ray Depth 7</h4>
    <div align="center">
        <table style="width=100%">
            <tr>
                <td align="middle">
                    <img src="images/CBdragon_microfacet_copper_zinc.png" width="360px" />
                    <figcaption align="middle">Copper-Zinc Alloy, α = 0.5</figcaption>
                </td>
                <td align="middle">
                    <img src="images/CBdragon_microfacet_Nickel_Iron.png" width="360" />
                    <figcaption align="middle">Nickel-Iron Alloy, α = 0.5</figcaption>
                </td>
            </tr>
            <tr>
                <td align="middle">
                    <img src="images/CBspheres_microfacet_al_ag_256_1_7.png" width="360" />
                    <figcaption align="middle">Aluminum and Silver</figcaption>
                </td>
            </tr>
        </table>
    </div>
</div>
</body>
</html>




